# User Guide

This guide describes how traders interact with the Ephemeral Vault System through their parent wallets and ephemeral sessions.

## Concepts
- **Parent wallet** – your main custody wallet that holds funds and authorizes sessions.
- **Ephemeral wallet** – a temporary session wallet generated by the backend and used for high-frequency trading operations.
- **Ephemeral vault** – an on-chain PDA account that tracks session parameters and fee/margin accounting.
- **Session** – a time-bounded trading context linking a parent wallet, an ephemeral wallet, and a vault.

## Typical Session Flow
1. **Connect parent wallet** in the trading UI.
2. **Create session**:
   - The UI calls `POST /session/create` with your parent wallet, desired duration, and maximum fee budget (`max_deposit`).
   - The backend generates an ephemeral wallet and returns its public key along with a session id.
3. **Approve on-chain delegation**:
   - The UI prompts your parent wallet to sign a transaction that:
     - Creates the vault (`create_vault`).
     - Approves the ephemeral wallet as delegate (`approve_delegate`).
   - After confirmation, the UI calls `POST /session/approve` to mark the session active.
4. **Trade using ephemeral wallet**:
   - The UI (or backend) ensures the vault has enough SOL for fees using `POST /session/deposit`.
   - Orders are sent through the dark pool; the ephemeral wallet signs trades, while the vault tracks fee/margin usage.
   - You do not need to re-sign each trade with the parent wallet.
5. **End session**:
   - You can explicitly end the session via a UI action that triggers `DELETE /session/revoke` and an on-chain `revoke_access`.
   - Otherwise the session expires after `session_expiry` and `cleanup_vault` returns unused funds to the parent wallet.

## Parent Wallet Responsibilities
- Approve the initial session creation and delegation.
- Optionally increase `max_deposit` by creating a new session.
- Revoke sessions you no longer use.
- Keep your parent wallet private keys and devices secure.

## Managing Sessions
- **Check status** via `GET /session/status?session_id=<uuid>`.
- **View live updates** by connecting to `/ws/session` in the UI.
- **Revoke** when done trading or if you suspect compromise.

## Troubleshooting
- **Session does not activate**:
  - Ensure the `create_vault` and `approve_delegate` transactions were confirmed on-chain.
  - Call `/session/approve` again with the correct vault PDA.
- **Insufficient fee balance**:
  - Request a top-up using `/session/deposit` or recreate the session with a higher `max_deposit`.
- **Session unexpectedly expired**:
  - Check the configured `session_duration_secs` when the session was created.
  - Create a new session with a longer duration if needed.

For detailed architecture and security information, see `docs/architecture.md` and `docs/security.md`.
